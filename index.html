
 <!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bibliothèque de Jeux de Mémoire</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
        body { font-family: 'Poppins', sans-serif; }
        .card-flip { transform-style: preserve-3d; transition: transform 0.6s; }
        .card-flip.flipped { transform: rotateY(180deg); }
        .card-front, .card-back { backface-visibility: hidden; position: absolute; width: 100%; height: 100%; }
        .card-back { transform: rotateY(180deg); }
        
        .language-btn.active { background: rgba(59, 130, 246, 0.6); box-shadow: 0 0 10px rgba(59, 130, 246, 0.4); }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        @keyframes fall {
            0% { transform: translateY(-50px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
        
        @keyframes fadeOut {
            0% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
        }

        /* Styles Pac-Man */
        .pacman-grid { 
            display: grid; 
            grid-template-columns: repeat(12, 30px); 
            gap: 1px; 
            justify-content: center; 
            background: #000;
            padding: 10px;
            border-radius: 10px;
        }
        .pacman-cell { 
            width: 30px; 
            height: 30px; 
            background: #000; 
            position: relative; 
            border: 1px solid #333;
        }
        .pacman-wall { background: #0066ff !important; }
        .pacman-dot { 
            background: #ffff00; 
            border-radius: 50%; 
            width: 8px; 
            height: 8px; 
            position: absolute; 
            top: 11px; 
            left: 11px; 
            box-shadow: 0 0 4px rgba(255, 255, 0, 0.8);
        }
        .pacman-power { 
            background: #ffff00; 
            border-radius: 50%; 
            width: 12px; 
            height: 12px; 
            position: absolute; 
            top: 9px; 
            left: 9px; 
            animation: pulse 1s infinite;
            box-shadow: 0 0 8px rgba(255, 255, 0, 1);
        }
        .pacman-player { 
            width: 26px; 
            height: 26px; 
            position: absolute; 
            top: 2px; 
            left: 2px; 
            z-index: 10;
            background: #ffff00;
            border-radius: 50%;
            position: relative;
            border: 2px solid #ffcc00;
            box-shadow: 0 0 8px rgba(255, 255, 0, 0.6);
        }
        
        .pacman-player::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            width: calc(100% + 4px);
            height: calc(100% + 4px);
            background: #000;
            border-radius: 50%;
            animation: pacman-chomp 0.4s infinite;
            z-index: 1;
        }
        
        .pacman-player::after {
            content: '';
            position: absolute;
            top: 6px;
            right: 8px;
            width: 4px;
            height: 4px;
            background: #000;
            border-radius: 50%;
            z-index: 2;
        }
        
        .pacman-right::before {
            clip-path: polygon(50% 50%, 100% 0%, 100% 100%);
            animation: pacman-chomp-right 0.4s infinite;
        }
        
        .pacman-left::before {
            clip-path: polygon(50% 50%, 0% 0%, 0% 100%);
            animation: pacman-chomp-left 0.4s infinite;
        }
        
        .pacman-up::before {
            clip-path: polygon(50% 50%, 0% 0%, 100% 0%);
            animation: pacman-chomp-up 0.4s infinite;
        }
        
        .pacman-down::before {
            clip-path: polygon(50% 50%, 0% 100%, 100% 100%);
            animation: pacman-chomp-down 0.4s infinite;
        }
        
        @keyframes pacman-chomp-right {
            0%, 100% { 
                clip-path: polygon(50% 50%, 100% 0%, 100% 100%);
            }
            50% { 
                clip-path: polygon(50% 50%, 100% 35%, 100% 65%);
            }
        }
        
        @keyframes pacman-chomp-left {
            0%, 100% { 
                clip-path: polygon(50% 50%, 0% 0%, 0% 100%);
            }
            50% { 
                clip-path: polygon(50% 50%, 0% 35%, 0% 65%);
            }
        }
        
        @keyframes pacman-chomp-up {
            0%, 100% { 
                clip-path: polygon(50% 50%, 0% 0%, 100% 0%);
            }
            50% { 
                clip-path: polygon(50% 50%, 35% 0%, 65% 0%);
            }
        }
        
        @keyframes pacman-chomp-down {
            0%, 100% { 
                clip-path: polygon(50% 50%, 0% 100%, 100% 100%);
            }
            50% { 
                clip-path: polygon(50% 50%, 35% 100%, 65% 100%);
            }
        }
        .pacman-ghost { 
            border-radius: 50% 50% 0 0; 
            width: 26px; 
            height: 26px; 
            position: absolute; 
            top: 2px; 
            left: 2px; 
            z-index: 9;
        }
        .ghost-red { background: #ff0000; }
        .ghost-pink { background: #ffb8ff; }
        .ghost-cyan { background: #00ffff; }
        .ghost-orange { background: #ffb852; }
        .ghost-scared { background: #0000ff !important; animation: blink 0.5s infinite; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        @keyframes blink {
            0%, 100% { background: #0000ff; }
            50% { background: #ffffff; }
        }

        .pacman-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            max-width: 200px;
            margin: 20px auto;
        }
        
        .control-btn {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }
        
        .control-btn:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 min-h-screen">
    <!-- Header -->
    <header class="bg-black/20 backdrop-blur-sm border-b border-white/10 sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-white" data-translate="title">🧠 Bibliothèque de Jeux de Mémoire</h1>
            <div class="flex items-center gap-4">
                <!-- Sélecteur de langue -->
                <div class="relative">
                    <button id="languageToggle" onclick="toggleLanguageMenu()" class="flex items-center gap-2 bg-white/10 rounded-lg px-4 py-2 border border-white/20 hover:bg-white/20 transition-all">
                        <span id="currentFlag" class="text-lg">🇫🇷</span>
                        <span id="currentLang" class="text-sm font-medium text-white">Français</span>
                        <svg class="w-4 h-4 text-white transition-transform" id="languageArrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                        </svg>
                    </button>
                    
                    <!-- Menu déroulant -->
                    <div id="languageMenu" class="absolute top-full right-0 mt-2 bg-black/80 backdrop-blur-sm rounded-lg border border-white/20 shadow-xl z-50 min-w-[160px] hidden">
                        <button onclick="selectLanguage('fr', '🇫🇷', 'Français')" class="language-option w-full flex items-center gap-3 px-4 py-3 hover:bg-white/10 transition-colors text-left border-b border-white/10">
                            <span class="text-lg">🇫🇷</span>
                            <span class="text-sm font-medium text-white">Français</span>
                        </button>
                        <button onclick="selectLanguage('en', '🇺🇸', 'English')" class="language-option w-full flex items-center gap-3 px-4 py-3 hover:bg-white/10 transition-colors text-left border-b border-white/10">
                            <span class="text-lg">🇺🇸</span>
                            <span class="text-sm font-medium text-white">English</span>
                        </button>
                        <button onclick="selectLanguage('es', '🇪🇸', 'Español')" class="language-option w-full flex items-center gap-3 px-4 py-3 hover:bg-white/10 transition-colors text-left border-b border-white/10">
                            <span class="text-lg">🇪🇸</span>
                            <span class="text-sm font-medium text-white">Español</span>
                        </button>
                        <button onclick="selectLanguage('ar', '🇸🇦', 'العربية')" class="language-option w-full flex items-center gap-3 px-4 py-3 hover:bg-white/10 transition-colors text-left border-b border-white/10">
                            <span class="text-lg">🇸🇦</span>
                            <span class="text-sm font-medium text-white">العربية</span>
                        </button>
                        <button onclick="selectLanguage('zh', '🇨🇳', '中文')" class="language-option w-full flex items-center gap-3 px-4 py-3 hover:bg-white/10 transition-colors text-left">
                            <span class="text-lg">🇨🇳</span>
                            <span class="text-sm font-medium text-white">中文</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8">
        <div class="text-center mb-8">
            <h2 class="text-4xl font-bold text-white mb-4" data-translate="main-title">Jeux de Mémoire Interactifs</h2>
            <p class="text-xl text-gray-300" data-translate="main-subtitle">Entraînez votre mémoire avec des variations infinies</p>
        </div>

        <!-- Jeux de Mémoire -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 text-center hover:bg-white/20 transition-all cursor-pointer" onclick="selectGame('easy')">
                <div class="text-4xl mb-3">🐱</div>
                <h3 class="text-xl font-bold text-white mb-2" data-translate="game1-title">Mode Facile</h3>
                <p class="text-gray-300 text-sm" data-translate="game1-desc">Animaux mignons</p>
            </div>

            <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 text-center hover:bg-white/20 transition-all cursor-pointer" onclick="selectGame('classic')">
                <div class="text-4xl mb-3">⚽</div>
                <h3 class="text-xl font-bold text-white mb-2" data-translate="game2-title">Mode Classique</h3>
                <p class="text-gray-300 text-sm" data-translate="game2-desc">Sports & loisirs</p>
            </div>

            <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 text-center hover:bg-white/20 transition-all cursor-pointer" onclick="selectGame('simon')">
                <div class="text-4xl mb-3">🎵</div>
                <h3 class="text-xl font-bold text-white mb-2" data-translate="game3-title">Simon Says</h3>
                <p class="text-gray-300 text-sm" data-translate="game3-desc">Séquences musicales</p>
            </div>

            <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 text-center hover:bg-white/20 transition-all cursor-pointer" onclick="selectGame('expert')">
                <div class="text-4xl mb-3">💎</div>
                <h3 class="text-xl font-bold text-white mb-2" data-translate="game4-title">Mode Expert</h3>
                <p class="text-gray-300 text-sm" data-translate="game4-desc">Gemmes précieuses</p>
            </div>

            <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 text-center hover:bg-white/20 transition-all cursor-pointer" onclick="selectGame('speed')">
                <div class="text-4xl mb-3">⚡</div>
                <h3 class="text-xl font-bold text-white mb-2" data-translate="game5-title">Speed Challenge</h3>
                <p class="text-gray-300 text-sm" data-translate="game5-desc">Défi de rapidité</p>
            </div>

            <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 text-center hover:bg-white/20 transition-all cursor-pointer" onclick="selectGame('mega')">
                <div class="text-4xl mb-3">🧠</div>
                <h3 class="text-xl font-bold text-white mb-2" data-translate="game6-title">Mega Memory</h3>
                <p class="text-gray-300 text-sm" data-translate="game6-desc">Mémorisation avancée</p>
            </div>

            <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 text-center hover:bg-white/20 transition-all cursor-pointer" onclick="selectGame('nature')">
                <div class="text-4xl mb-3">🌿</div>
                <h3 class="text-xl font-bold text-white mb-2" data-translate="game7-title">Nature Quest</h3>
                <p class="text-gray-300 text-sm" data-translate="game7-desc">Observation de la nature</p>
            </div>

            <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 text-center hover:bg-white/20 transition-all cursor-pointer" onclick="selectGame('space')">
                <div class="text-4xl mb-3">🚀</div>
                <h3 class="text-xl font-bold text-white mb-2" data-translate="game8-title">Space Adventure</h3>
                <p class="text-gray-300 text-sm" data-translate="game8-desc">Navigation spatiale</p>
            </div>

            <div class="bg-white/10 backdrop-blur-sm rounded-xl p-6 text-center hover:bg-white/20 transition-all cursor-pointer" onclick="selectGame('pacman')">
                <div class="text-4xl mb-3">👾</div>
                <h3 class="text-xl font-bold text-white mb-2" data-translate="game9-title">Pac-Man Cognitif</h3>
                <p class="text-gray-300 text-sm" data-translate="game9-desc">Stratégie et mémoire</p>
            </div>
        </div>
    </div>

    <!-- Zone de jeu -->
    <div id="gameArea" class="container mx-auto px-4 pb-8 hidden">
        <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-8">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center gap-4">
                    <h3 id="gameTitle" class="text-2xl font-bold text-white"></h3>
                    <div id="playerLevelBadge" class="bg-gradient-to-r from-purple-500 to-blue-500 text-yellow-300 px-3 py-1 rounded-full text-sm font-bold border border-yellow-400/30">
                        <span data-translate="your-level">Votre niveau</span>: <span id="playerLevelNumber">1</span>
                    </div>
                </div>
                <div class="flex gap-4 items-center">
                    <div class="text-white"><span data-translate="score">Score</span>: <span id="score" class="font-bold text-yellow-400">0</span></div>
                    <div class="text-white"><span data-translate="level">Niveau</span>: <span id="level" class="font-bold text-green-400">1</span></div>
                    <div class="text-white"><span data-translate="time">Temps</span>: <span id="timer" class="font-bold text-blue-400">0s</span></div>
                    <button id="pauseBtn" onclick="togglePause()" class="bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg transition-colors" data-translate="pause">⏸️ Pause</button>
                    <button onclick="resetGame()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors" data-translate="restart">Recommencer</button>
                    <button onclick="backToMenu()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors" data-translate="back-menu">Menu</button>
                </div>
            </div>
            
            <div id="gameBoard" class="grid gap-4 justify-center"></div>
            
            <!-- Contrôles Pac-Man -->
            <div id="pacmanControls" class="hidden">
                <div class="pacman-controls">
                    <div></div>
                    <button class="control-btn" onclick="movePacman('up')">↑</button>
                    <div></div>
                    <button class="control-btn" onclick="movePacman('left')">←</button>
                    <button class="control-btn" onclick="pauseGame()" style="background: rgba(255,255,0,0.3);">⏸</button>
                    <button class="control-btn" onclick="movePacman('right')">→</button>
                    <div></div>
                    <button class="control-btn" onclick="movePacman('down')">↓</button>
                    <div></div>
                </div>
                <div class="text-center mt-4">
                    <p class="text-gray-300 text-sm" data-translate="pacman-instructions">Utilisez les flèches ou WASD pour vous déplacer</p>
                </div>
            </div>
            
            <!-- Overlay de pause -->
            <div id="pauseOverlay" class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center hidden">
                <div class="bg-white/10 backdrop-blur-sm rounded-2xl p-8 text-center border border-white/20">
                    <h3 class="text-3xl font-bold text-white mb-4">⏸️ <span data-translate="game-paused">Jeu en Pause</span></h3>
                    <p class="text-gray-300 mb-6" data-translate="pause-message">Le jeu est temporairement arrêté. Prenez votre temps !</p>
                    <div class="flex gap-4 justify-center">
                        <button onclick="togglePause()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-bold transition-colors">
                            ▶️ <span data-translate="resume">Reprendre</span>
                        </button>
                        <button onclick="resetGame()" class="bg-red-500 hover:bg-red-600 text-white px-6 py-3 rounded-lg font-bold transition-colors" data-translate="restart">
                            Recommencer
                        </button>
                        <button onclick="backToMenu()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-bold transition-colors" data-translate="back-menu">
                            Menu
                        </button>
                    </div>
                </div>
            </div>

            <div id="gameComplete" class="text-center mt-8 hidden">
                <h3 class="text-3xl font-bold text-green-400 mb-4" data-translate="congratulations">🎉 Félicitations !</h3>
                <p class="text-xl text-white mb-4"><span data-translate="completed-in">Vous avez terminé en</span> <span id="finalTime"></span> <span data-translate="with-score">avec un score de</span> <span id="finalScore"></span> !</p>
                <button onclick="selectGame(currentGame)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-bold transition-colors" data-translate="play-again">Rejouer</button>
            </div>
        </div>
    </div>

    <script>
        let currentGame = '';
        let gameData = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let score = 0;
        let level = 1;
        let startTime = 0;
        let timerInterval = null;
        let currentLanguage = 'fr';
        let gameLoop = null;
        let isPaused = false;
        let pausedTime = 0;
        
        // Système de sauvegarde des niveaux
        let gameLevels = JSON.parse(localStorage.getItem('memoryGameLevels')) || {};

        // Variables Pac-Man
        let pacmanGrid = [];
        let pacmanPos = { x: 1, y: 1 };
        let ghosts = [];
        let dots = [];
        let powerPellets = [];
        let gameRunning = false;
        let ghostScaredTime = 0;

        // Traductions
        const translations = {
            fr: {
                'title': '🧠 Bibliothèque de Jeux de Mémoire',
                'main-title': 'Jeux de Mémoire Interactifs',
                'main-subtitle': 'Entraînez votre mémoire avec des variations infinies',
                'game1-title': 'Mode Facile',
                'game1-desc': 'Animaux mignons',
                'game2-title': 'Mode Classique',
                'game2-desc': 'Sports & loisirs',
                'game3-title': 'Simon Says',
                'game3-desc': 'Séquences musicales',
                'game4-title': 'Mode Expert',
                'game4-desc': 'Gemmes précieuses',
                'game5-title': 'Speed Challenge',
                'game5-desc': 'Défi de rapidité',
                'game6-title': 'Mega Memory',
                'game6-desc': 'Mémorisation avancée',
                'game7-title': 'Nature Quest',
                'game7-desc': 'Observation de la nature',
                'game8-title': 'Space Adventure',
                'game8-desc': 'Navigation spatiale',
                'game9-title': 'Pac-Man Cognitif',
                'game9-desc': 'Stratégie et mémoire',
                'your-level': 'Votre niveau',
                'score': 'Score',
                'level': 'Niveau',
                'time': 'Temps',
                'pause': 'Pause',
                'restart': 'Recommencer',
                'back-menu': 'Menu',
                'congratulations': '🎉 Félicitations !',
                'completed-in': 'Vous avez terminé en',
                'with-score': 'avec un score de',
                'play-again': 'Rejouer',
                'game-paused': 'Jeu en Pause',
                'pause-message': 'Le jeu est temporairement arrêté. Prenez votre temps !',
                'resume': 'Reprendre',
                'pacman-instructions': 'Utilisez les flèches ou WASD pour vous déplacer',
                'winMessage': '🎉 Félicitations ! Vous avez réussi.',
                'loseMessage': '😔 Pas de chance cette fois !',
                'encouragement': 'Ne vous découragez pas ! Chaque tentative améliore votre mémoire.',
                'retry': 'Réessayer',
                'menu': 'Menu Principal',
                'pacman-title': 'Pac-Man Cognitif',
                'pacman-description': 'Collectez tous les points tout en évitant les fantômes',
                'objective': 'Collectez tous les points tout en évitant les fantômes'
            },
            en: {
                'title': '🧠 Memory Games Library',
                'main-title': 'Interactive Memory Games',
                'main-subtitle': 'Train your memory with infinite variations',
                'game1-title': 'Easy Mode',
                'game1-desc': 'Cute animals',
                'game2-title': 'Classic Mode',
                'game2-desc': 'Sports & leisure',
                'game3-title': 'Simon Says',
                'game3-desc': 'Musical sequences',
                'game4-title': 'Expert Mode',
                'game4-desc': 'Precious gems',
                'game5-title': 'Speed Challenge',
                'game5-desc': 'Speed challenge',
                'game6-title': 'Mega Memory',
                'game6-desc': 'Advanced memorization',
                'game7-title': 'Nature Quest',
                'game7-desc': 'Nature observation',
                'game8-title': 'Space Adventure',
                'game8-desc': 'Space navigation',
                'game9-title': 'Cognitive Pac-Man',
                'game9-desc': 'Strategy and memory',
                'your-level': 'Your level',
                'score': 'Score',
                'level': 'Level',
                'time': 'Time',
                'pause': 'Pause',
                'restart': 'Restart',
                'back-menu': 'Menu',
                'congratulations': '🎉 Congratulations!',
                'completed-in': 'You completed in',
                'with-score': 'with a score of',
                'play-again': 'Play Again',
                'game-paused': 'Game Paused',
                'pause-message': 'The game is temporarily stopped. Take your time!',
                'resume': 'Resume',
                'pacman-instructions': 'Use arrows or WASD to move',
                'winMessage': '🎉 Congratulations! You succeeded.',
                'loseMessage': '😔 Better luck next time!',
                'encouragement': 'Don\'t give up! Every attempt improves your memory.',
                'retry': 'Retry',
                'menu': 'Main Menu',
                'pacman-title': 'Cognitive Pac-Man',
                'pacman-description': 'Collect all dots while avoiding ghosts',
                'objective': 'Collect all points while avoiding the ghosts'
            },
            es: {
                'title': '🧠 Biblioteca de Juegos de Memoria',
                'main-title': 'Juegos de Memoria Interactivos',
                'main-subtitle': 'Entrena tu memoria con variaciones infinitas',
                'game1-title': 'Modo Fácil',
                'game1-desc': 'Animales lindos',
                'game2-title': 'Modo Clásico',
                'game2-desc': 'Deportes y ocio',
                'game3-title': 'Simon Dice',
                'game3-desc': 'Secuencias musicales',
                'game4-title': 'Modo Experto',
                'game4-desc': 'Gemas preciosas',
                'game5-title': 'Desafío de Velocidad',
                'game5-desc': 'Desafío de rapidez',
                'game6-title': 'Mega Memoria',
                'game6-desc': 'Memorización avanzada',
                'game7-title': 'Aventura Natural',
                'game7-desc': 'Observación de la naturaleza',
                'game8-title': 'Aventura Espacial',
                'game8-desc': 'Navegación espacial',
                'game9-title': 'Pac-Man Cognitivo',
                'game9-desc': 'Estrategia y memoria',
                'your-level': 'Tu nivel',
                'score': 'Puntuación',
                'level': 'Nivel',
                'time': 'Tiempo',
                'pause': 'Pausa',
                'restart': 'Reiniciar',
                'back-menu': 'Menú',
                'congratulations': '🎉 ¡Felicitaciones!',
                'completed-in': 'Completaste en',
                'with-score': 'con una puntuación de',
                'play-again': 'Jugar de Nuevo',
                'game-paused': 'Juego Pausado',
                'pause-message': 'El juego está temporalmente detenido. ¡Tómate tu tiempo!',
                'resume': 'Reanudar',
                'pacman-instructions': 'Usa las flechas o WASD para moverte',
                'winMessage': '🎉 ¡Felicidades! Lo lograste.',
                'loseMessage': '😔 ¡Más suerte la próxima vez!',
                'encouragement': '¡No te rindas! Cada intento mejora tu memoria.',
                'retry': 'Reintentar',
                'menu': 'Menú Principal',
                'pacman-title': 'Pac-Man Cognitivo',
                'pacman-description': 'Recoge todos los puntos evitando los fantasmas',
                'objective': 'Recoge todos los puntos evitando los fantasmas'
            },
            ar: {
                'title': '🧠 مكتبة ألعاب الذاكرة',
                'main-title': 'ألعاب الذاكرة التفاعلية',
                'main-subtitle': 'درب ذاكرتك مع تنويعات لا نهائية',
                'game1-title': 'الوضع السهل',
                'game1-desc': 'حيوانات لطيفة',
                'game2-title': 'الوضع الكلاسيكي',
                'game2-desc': 'رياضة وترفيه',
                'game3-title': 'سايمون يقول',
                'game3-desc': 'تسلسلات موسيقية',
                'game4-title': 'وضع الخبير',
                'game4-desc': 'أحجار كريمة',
                'game5-title': 'تحدي السرعة',
                'game5-desc': 'تحدي السرعة',
                'game6-title': 'ميجا ميموري',
                'game6-desc': 'حفظ متقدم',
                'game7-title': 'مغامرة الطبيعة',
                'game7-desc': 'مراقبة الطبيعة',
                'game8-title': 'مغامرة الفضاء',
                'game8-desc': 'ملاحة فضائية',
                'game9-title': 'باك مان المعرفي',
                'game9-desc': 'استراتيجية وذاكرة',
                'your-level': 'مستواك',
                'score': 'النقاط',
                'level': 'المستوى',
                'time': 'الوقت',
                'pause': 'إيقاف',
                'restart': 'إعادة البدء',
                'back-menu': 'القائمة',
                'congratulations': '🎉 تهانينا!',
                'completed-in': 'أكملت في',
                'with-score': 'بنقاط',
                'play-again': 'العب مرة أخرى',
                'game-paused': 'اللعبة متوقفة',
                'pause-message': 'اللعبة متوقفة مؤقتاً. خذ وقتك!',
                'resume': 'استئناف',
                'pacman-instructions': 'استخدم الأسهم أو WASD للحركة',
                'winMessage': '🎉 تهانينا! لقد نجحت.',
                'loseMessage': '😔 حظاً أوفر في المرة القادمة!',
                'encouragement': 'لا تستسلم! كل محاولة تقوي ذاكرتك.',
                'retry': 'أعد المحاولة',
                'menu': 'القائمة الرئيسية',
                'pacman-title': 'باك مان المعرفي',
                'pacman-description': 'اجمع كل النقاط مع تجنب الأشباح',
                'objective': 'اجمع كل النقاط وتجنب الأشباح'
            },
            zh: {
                'title': '🧠 记忆游戏库',
                'main-title': '互动记忆游戏',
                'main-subtitle': '通过无限变化训练你的记忆力',
                'game1-title': '简单模式',
                'game1-desc': '可爱动物',
                'game2-title': '经典模式',
                'game2-desc': '运动休闲',
                'game3-title': '西蒙说',
                'game3-desc': '音乐序列',
                'game4-title': '专家模式',
                'game4-desc': '珍贵宝石',
                'game5-title': '速度挑战',
                'game5-desc': '速度挑战',
                'game6-title': '超级记忆',
                'game6-desc': '高级记忆',
                'game7-title': '自然探索',
                'game7-desc': '自然观察',
                'game8-title': '太空冒险',
                'game8-desc': '太空导航',
                'game9-title': '认知吃豆人',
                'game9-desc': '策略和记忆',
                'your-level': '你的等级',
                'score': '分数',
                'level': '等级',
                'time': '时间',
                'pause': '暂停',
                'restart': '重新开始',
                'back-menu': '菜单',
                'congratulations': '🎉 恭喜！',
                'completed-in': '你在',
                'with-score': '完成，得分',
                'play-again': '再玩一次',
                'game-paused': '游戏暂停',
                'pause-message': '游戏暂时停止。慢慢来！',
                'resume': '继续',
                'pacman-instructions': '使用箭头键或WASD移动',
                'winMessage': '🎉 恭喜！你成功了。',
                'loseMessage': '😔 下次好运！',
                'encouragement': '别放弃！每次尝试都会提升你的记忆力。',
                'retry': '重试',
                'menu': '主菜单',
                'pacman-title': '认知吃豆人',
                'pacman-description': '收集所有点数同时避开幽灵',
                'objective': '收集所有点数并避开幽灵'
            }
        };

        // Données des jeux avec variétés d'images infinies
        const gameVariations = {
            easy: {
                title: '🐱 Easy Mode - Animals',
                type: 'memory',
                variations: [
                    ['🐱', '🐶', '🐰', '🦊', '🐻', '🐼'], // Cute animals
                    ['🐸', '🐯', '🦁', '🐨', '🐵', '🐧'], // Wild animals
                    ['🐮', '🐷', '🐴', '🐑', '🐔', '🦆'], // Farm animals
                    ['🐙', '🐠', '🐟', '🦈', '🐳', '🐬'], // Sea animals
                    ['🦋', '🐝', '🐞', '🦗', '🐛', '🐜'], // Insects
                    ['🦅', '🦆', '🦉', '🐦', '🦜', '🕊️'], // Birds
                    ['🐺', '🦝', '🦔', '🐿️', '🦫', '🦨'], // Forest animals
                    ['🦒', '🦏', '🦛', '🐘', '🦓', '🐆'] // African animals
                ],
                gridSize: 3,
                pairs: 6
            },
            classic: {
                title: '⚽ Classic Mode - Sports',
                type: 'memory',
                variations: [
                    ['⚽', '🏀', '🎾', '🏈', '🏐', '🏓', '🎱', '🏸'], // Classic sports
                    ['🏊', '🚴', '🏃', '🤸', '🏋️', '🤾', '🏌️', '🧗'], // Olympic sports
                    ['🎯', '🎪', '🎨', '🎭', '🎪', '🎲', '🃏', '🎰'], // Games and leisure
                    ['🏆', '🥇', '🥈', '🥉', '🏅', '🎖️', '👑', '⭐'], // Awards
                    ['🎸', '🎹', '🥁', '🎺', '🎷', '🎻', '🎤', '🎧'], // Instruments
                    ['🚗', '🚕', '🚙', '🚌', '🚎', '🏎️', '🚓', '🚑'], // Vehicles
                    ['✈️', '🚁', '🛸', '🚀', '🛩️', '🚂', '🚢', '⛵'], // Transportation
                    ['🏠', '🏢', '🏰', '🗼', '🎡', '🎢', '🎠', '🎪'] // Buildings
                ],
                gridSize: 4,
                pairs: 8
            },
            simon: {
                title: '🎵 Simon Says - Sequences',
                type: 'simon',
                variations: [
                    ['🔴', '🔵', '🟢', '🟡'], // Basic colors
                    ['❤️', '💙', '💚', '💛'], // Colored hearts
                    ['🌹', '🌊', '🌿', '☀️'], // Natural elements
                    ['🍎', '🫐', '🥬', '🍌'], // Fruits/vegetables
                    ['🔥', '❄️', '⚡', '🌟'], // Elements
                    ['💎', '🔷', '🟢', '🟨'], // Geometric shapes
                    ['🎈', '🎀', '🎁', '🎊'], // Party
                    ['🌺', '🌸', '🌼', '🌻'] // Flowers
                ],
                sequence: [],
                playerSequence: [],
                level: 1
            },
            expert: {
                title: '💎 Expert Mode - Gems',
                type: 'memory',
                variations: [
                    ['💎', '💍', '👑', '🏆', '⭐', '✨', '💫', '🌟', '🔮', '💰'], // Treasures
                    ['🥇', '🥈', '🥉', '🏅', '🎖️', '🏆', '👑', '💎', '💍', '⚡'], // Awards
                    ['🌟', '⭐', '✨', '💫', '🌠', '☄️', '🌌', '🌙', '☀️', '🔥'], // Cosmos
                    ['🔥', '❄️', '⚡', '🌊', '🌪️', '🌈', '☀️', '🌙', '⭐', '💫'], // Elements
                    ['🎭', '🎪', '🎨', '🎬', '🎤', '🎧', '🎵', '🎶', '🎼', '🎹'], // Arts
                    ['🏰', '🗼', '🎡', '🎢', '🎠', '🎪', '🎭', '🎨', '🎬', '🎤'], // Monuments
                    ['🦄', '🐉', '🧚', '🧞', '🧙', '🦸', '🦹', '👸', '🤴', '👑'], // Fantasy
                    ['🚀', '🛸', '👽', '🌍', '🌎', '🌏', '🪐', '🌙', '⭐', '🌟'] // Space
                ],
                gridSize: 4,
                pairs: 10
            },
            speed: {
                title: '⚡ Speed Challenge - Speed',
                type: 'speed',
                variations: [
                    { items: ['🍎', '🍌', '🍊', '🍇', '🍓', '🥝'], target: '🍎' }, // Fruits
                    { items: ['🥕', '🥬', '🥒', '🍅', '🥔', '🌽'], target: '🥕' }, // Vegetables
                    { items: ['🍕', '🍔', '🌭', '🍟', '🥪', '🌮'], target: '🍕' }, // Fast food
                    { items: ['🍰', '🧁', '🍪', '🍩', '🍫', '🍬'], target: '🍰' }, // Desserts
                    { items: ['☕', '🥤', '🧃', '🍵', '🥛', '🍷'], target: '☕' }, // Beverages
                    { items: ['⚽', '🏀', '🎾', '🏈', '🏐', '🏓'], target: '⚽' }, // Sports
                    { items: ['🌸', '🌺', '🌻', '🌹', '🌷', '🌼'], target: '🌸' }, // Flowers
                    { items: ['🚗', '🚕', '🚙', '🚌', '🏎️', '🚓'], target: '🚗' } // Cars
                ],
                timeLimit: 30
            },
            mega: {
                title: '🧠 Mega Memory - Memorization',
                type: 'sequence',
                variations: [
                    ['📱', '💻', '⌚', '🎧', '📷', '🖥️'], // Technology
                    ['🏠', '🚗', '✈️', '🚢', '🚂', '🚁'], // Transport/Home
                    ['🍎', '🌮', '☕', '🍕', '🍰', '🥤'], // Food
                    ['⚽', '🎸', '📚', '🎨', '🎭', '🎪'], // Leisure
                    ['🌞', '🌙', '⭐', '🌈', '☔', '❄️'], // Weather
                    ['👔', '👗', '👠', '🎩', '👑', '💍'], // Fashion
                    ['🐱', '🐶', '🐰', '🦊', '🐻', '🐼'], // Animals
                    ['🌸', '🌳', '🌊', '🏔️', '🌋', '🏖️'] // Nature
                ],
                sequence: [],
                showTime: 3000
            },
            nature: {
                title: '🌿 Nature Quest - Observation',
                type: 'find',
                variations: [
                    { items: ['🌳', '🌸', '🌺', '🌻', '🌹', '🌷', '🌼', '🍀'], target: '🌸', distractors: ['🌳', '🌺', '🌻', '🌹', '🌷', '🌼', '🍀'] }, // Flowers
                    { items: ['🦋', '🐝', '🐞', '🦗', '🐛', '🐜', '🕷️', '🦟'], target: '🦋', distractors: ['🐝', '🐞', '🦗', '🐛', '🐜', '🕷️', '🦟'] }, // Insects
                    { items: ['🌲', '🌳', '🌴', '🌵', '🌿', '🍃', '🌾', '🌱'], target: '🌲', distractors: ['🌳', '🌴', '🌵', '🌿', '🍃', '🌾', '🌱'] }, // Trees
                    { items: ['🐦', '🦅', '🦆', '🦉', '🦜', '🕊️', '🐓', '🦢'], target: '🐦', distractors: ['🦅', '🦆', '🦉', '🦜', '🕊️', '🐓', '🦢'] }, // Birds
                    { items: ['🍄', '🌰', '🌶️', '🥕', '🌽', '🥒', '🍅', '🥔'], target: '🍄', distractors: ['🌰', '🌶️', '🥕', '🌽', '🥒', '🍅', '🥔'] }, // Mushrooms/vegetables
                    { items: ['🐠', '🐟', '🦈', '🐙', '🦀', '🦞', '🐚', '🐡'], target: '🐠', distractors: ['🐟', '🦈', '🐙', '🦀', '🦞', '🐚', '🐡'] }, // Sea
                    { items: ['🌞', '🌙', '⭐', '☀️', '🌟', '💫', '🌠', '☄️'], target: '🌞', distractors: ['🌙', '⭐', '☀️', '🌟', '💫', '🌠', '☄️'] }, // Sky
                    { items: ['🏔️', '🌋', '🏖️', '🏜️', '🌊', '🏞️', '🌉', '🗻'], target: '🏔️', distractors: ['🌋', '🏖️', '🏜️', '🌊', '🏞️', '🌉', '🗻'] } // Landscapes
                ]
            },
            space: {
                title: '🚀 Space Adventure - Navigation',
                type: 'path',
                variations: [
                    ['🚀', '🛸', '🌍', '🌙', '⭐', '🪐'], // Classic space
                    ['👽', '🛸', '🌌', '🌠', '☄️', '🌟'], // Aliens
                    ['🌍', '🌎', '🌏', '🌙', '☀️', '🪐'], // Planets
                    ['⭐', '🌟', '💫', '✨', '🌠', '☄️'], // Stars
                    ['🚀', '🛰️', '🛸', '👨‍🚀', '👩‍🚀', '🌌'], // Astronauts
                    ['🌙', '🌛', '🌜', '🌚', '🌝', '🌞'], // Moon/Sun
                    ['🪐', '🌍', '🌎', '🌏', '🌙', '☀️'], // Solar system
                    ['🌌', '🌠', '☄️', '🌟', '⭐', '💫'] // Galaxy
                ],
                path: [],
                playerPath: []
            },
            pacman: {
                title: '👾 Pac-Man Cognitif',
                type: 'pacman',
                variations: [
                    {
                        name: 'Classic',
                        maze: [
                            [1,1,1,1,1,1,1,1,1,1,1,1],
                            [1,0,0,0,0,0,0,0,0,0,0,1],
                            [1,0,1,1,0,1,1,0,1,1,0,1],
                            [1,0,0,0,0,0,0,0,0,0,0,1],
                            [1,0,1,0,1,1,1,1,0,1,0,1],
                            [1,0,0,0,0,0,0,0,0,0,0,1],
                            [1,0,1,0,1,1,1,1,0,1,0,1],
                            [1,0,0,0,0,0,0,0,0,0,0,1],
                            [1,0,1,1,0,1,1,0,1,1,0,1],
                            [1,0,0,0,0,0,0,0,0,0,0,1],
                            [1,1,1,1,1,1,1,1,1,1,1,1]
                        ]
                    },
                    {
                        name: 'Memory',
                        maze: [
                            [1,1,1,1,1,1,1,1,1,1,1,1],
                            [1,0,0,0,1,0,0,1,0,0,0,1],
                            [1,0,1,0,0,0,0,0,0,1,0,1],
                            [1,0,0,0,1,0,0,1,0,0,0,1],
                            [1,1,0,1,1,0,0,1,1,0,1,1],
                            [1,0,0,0,0,0,0,0,0,0,0,1],
                            [1,1,0,1,1,0,0,1,1,0,1,1],
                            [1,0,0,0,1,0,0,1,0,0,0,1],
                            [1,0,1,0,0,0,0,0,0,1,0,1],
                            [1,0,0,0,1,0,0,1,0,0,0,1],
                            [1,1,1,1,1,1,1,1,1,1,1,1]
                        ]
                    },
                    {
                        name: 'Strategy',
                        maze: [
                            [1,1,1,1,1,1,1,1,1,1,1,1],
                            [1,0,0,0,0,0,0,0,0,0,0,1],
                            [1,0,1,0,1,1,1,1,0,1,0,1],
                            [1,0,1,0,0,0,0,0,0,1,0,1],
                            [1,0,1,1,1,0,0,1,1,1,0,1],
                            [1,0,0,0,0,0,0,0,0,0,0,1],
                            [1,0,1,1,1,0,0,1,1,1,0,1],
                            [1,0,1,0,0,0,0,0,0,1,0,1],
                            [1,0,1,0,1,1,1,1,0,1,0,1],
                            [1,0,0,0,0,0,0,0,0,0,0,1],
                            [1,1,1,1,1,1,1,1,1,1,1,1]
                        ]
                    }
                ]
            }
        };

        // Variable pour stocker les jeux actuels avec variation sélectionnée
        let games = {};
        
        // Fonctions de sauvegarde des niveaux
        function saveGameLevel(gameType, level) {
            gameLevels[gameType] = Math.max(gameLevels[gameType] || 1, level);
            localStorage.setItem('memoryGameLevels', JSON.stringify(gameLevels));
        }
        
        function getGameLevel(gameType) {
            return gameLevels[gameType] || 1;
        }

        // Fonction pour retourner au menu
        function backToMenu() {
            document.getElementById('gameArea').classList.add('hidden');
            document.getElementById('pacmanControls').classList.add('hidden');
            document.getElementById('pauseOverlay').classList.add('hidden');
            clearInterval(timerInterval);
            clearInterval(gameLoop);
            gameRunning = false;
            isPaused = false;
            pausedTime = 0;
        }

        // Fonction pour basculer la pause
        function togglePause() {
            const pauseBtn = document.getElementById('pauseBtn');
            const pauseOverlay = document.getElementById('pauseOverlay');
            
            if (isPaused) {
                // Reprendre le jeu
                isPaused = false;
                pauseOverlay.classList.add('hidden');
                pauseBtn.innerHTML = '⏸️ <span data-translate="pause">Pause</span>';
                pauseBtn.className = 'bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-lg transition-colors';
                
                // Ajuster le temps de début pour compenser la pause
                if (pausedTime > 0) {
                    startTime += (Date.now() - pausedTime);
                }
                
                // Redémarrer le timer
                if (currentGame !== 'pacman' || gameRunning) {
                    startTimer();
                }
                
                // Redémarrer la boucle de jeu pour Pac-Man
                if (currentGame === 'pacman' && gameRunning) {
                    gameLoop = setInterval(() => {
                        if (!isPaused && gameRunning) {
                            updateGhosts();
                            checkCollisions();
                            checkWinCondition();
                        }
                    }, 200);
                }
            } else {
                // Mettre en pause
                isPaused = true;
                pausedTime = Date.now();
                pauseOverlay.classList.remove('hidden');
                pauseBtn.innerHTML = '▶️ <span data-translate="resume">Reprendre</span>';
                pauseBtn.className = 'bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors';
                
                // Arrêter le timer
                clearInterval(timerInterval);
                
                // Arrêter la boucle de jeu pour Pac-Man
                if (gameLoop) {
                    clearInterval(gameLoop);
                }
            }
        }

        // Fonction pour sélectionner une variation aléatoire d'un jeu
        function getRandomGameVariation(gameType) {
            const gameTemplate = gameVariations[gameType];
            const randomIndex = Math.floor(Math.random() * gameTemplate.variations.length);
            
            // Créer une copie du jeu avec la variation sélectionnée
            const game = {
                title: gameTemplate.title,
                type: gameTemplate.type,
                ...gameTemplate
            };
            
            // Appliquer la variation selon le type de jeu
            if (gameTemplate.type === 'memory') {
                game.items = [...gameTemplate.variations[randomIndex]];
            } else if (gameTemplate.type === 'simon') {
                game.colors = [...gameTemplate.variations[randomIndex]];
            } else if (gameTemplate.type === 'speed') {
                const variation = gameTemplate.variations[randomIndex];
                game.items = [...variation.items];
                game.target = variation.target;
            } else if (gameTemplate.type === 'sequence') {
                game.items = [...gameTemplate.variations[randomIndex]];
            } else if (gameTemplate.type === 'find') {
                const variation = gameTemplate.variations[randomIndex];
                game.items = [...variation.items];
                game.target = variation.target;
                game.distractors = [...variation.distractors];
            } else if (gameTemplate.type === 'path') {
                game.items = [...gameTemplate.variations[randomIndex]];
            } else if (gameTemplate.type === 'pacman') {
                game.maze = gameTemplate.variations[randomIndex];
            }
            
            return game;
        }

        function selectGame(gameType) {
            currentGame = gameType;
            
            // Sélectionner une nouvelle variation aléatoire à chaque partie
            const game = getRandomGameVariation(gameType);
            games[gameType] = game; // Stocker la variation actuelle
            
            document.getElementById('gameTitle').textContent = game.title;
            document.getElementById('gameArea').classList.remove('hidden');
            
            // Afficher le niveau personnel du joueur
            const playerLevel = getGameLevel(gameType);
            document.getElementById('playerLevelNumber').textContent = playerLevel;
            
            // Réinitialiser les variables communes
            flippedCards = [];
            matchedPairs = 0;
            score = 0;
            level = getGameLevel(gameType); // Commencer au niveau sauvegardé
            startTime = Date.now();
            
            // Créer le jeu selon son type
            switch(game.type) {
                case 'memory':
                    createMemoryGame(game);
                    break;
                case 'simon':
                    createSimonGame(game);
                    break;
                case 'speed':
                    createSpeedGame(game);
                    break;
                case 'sequence':
                    createSequenceGame(game);
                    break;
                case 'find':
                    createFindGame(game);
                    break;
                case 'path':
                    createPathGame(game);
                    break;
                case 'pacman':
                    createPacmanGame(game);
                    break;
            }
            
            if (game.type !== 'pacman') {
                startTimer();
            }
            
            // Scroll vers le jeu
            document.getElementById('gameArea').scrollIntoView({ behavior: 'smooth' });
        }

        // NOUVEAU JEU PAC-MAN
        function createPacmanGame(game) {
            const board = document.getElementById('gameBoard');
            
            board.innerHTML = `
                <div class="text-center mb-6">
                    <h4 class="text-xl text-white mb-4" data-translate="pacman-title">Pac-Man Cognitif</h4>
                    <p id="objectiveText" class="text-gray-300" data-translate="objective">Collectez tous les points tout en évitant les fantômes</p>
                </div>
                <div id="pacmanMaze" class="pacman-grid">
                </div>
            `;
            
            document.getElementById('pacmanControls').classList.remove('hidden');
            
            // Initialiser le labyrinthe
            initializePacmanMaze(game.maze);
            
            // Démarrer le jeu
            startPacmanGame();
        }

        function initializePacmanMaze(mazeData) {
            const maze = document.getElementById('pacmanMaze');
            maze.innerHTML = '';
            pacmanGrid = [];
            dots = [];
            powerPellets = [];
            ghosts = [];
            
            // Créer la grille
            for (let y = 0; y < mazeData.maze.length; y++) {
                for (let x = 0; x < mazeData.maze[y].length; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'pacman-cell';
                    cell.id = `cell-${x}-${y}`;
                    
                    if (mazeData.maze[y][x] === 1) {
                        cell.classList.add('pacman-wall');
                    } else {
                        // Ajouter des points
                        if (Math.random() < 0.7) {
                            const dot = document.createElement('div');
                            dot.className = 'pacman-dot';
                            cell.appendChild(dot);
                            dots.push({x, y});
                        }
                        
                        // Ajouter des power pellets
                        if (Math.random() < 0.1) {
                            const power = document.createElement('div');
                            power.className = 'pacman-power';
                            cell.appendChild(power);
                            powerPellets.push({x, y});
                        }
                    }
                    
                    pacmanGrid.push(cell);
                    maze.appendChild(cell);
                }
            }
            
            // Positionner Pac-Man
            pacmanPos = { x: 1, y: 1, direction: 'right' };
            updatePacmanPosition();
            
            // Créer les fantômes
            createGhosts();
        }

        function createGhosts() {
            const colors = ['red', 'pink', 'cyan', 'orange'];
            ghosts = [];
            
            for (let i = 0; i < Math.min(level + 1, 4); i++) {
                const ghost = {
                    x: 10 - i,
                    y: 1,
                    color: colors[i],
                    scared: false,
                    direction: { x: -1, y: 0 }
                };
                ghosts.push(ghost);
                updateGhostPosition(ghost);
            }
        }

        function updatePacmanPosition() {
            // Supprimer l'ancien Pac-Man
            document.querySelectorAll('.pacman-player').forEach(p => p.remove());
            
            // Ajouter le nouveau Pac-Man
            const cell = document.getElementById(`cell-${pacmanPos.x}-${pacmanPos.y}`);
            if (cell) {
                const pacman = document.createElement('div');
                pacman.className = `pacman-player pacman-${pacmanPos.direction || 'right'}`;
                cell.appendChild(pacman);
            }
        }

        function updateGhostPosition(ghost) {
            // Supprimer l'ancien fantôme
            document.querySelectorAll(`.ghost-${ghost.color}`).forEach(g => g.remove());
            
            // Ajouter le nouveau fantôme
            const cell = document.getElementById(`cell-${ghost.x}-${ghost.y}`);
            if (cell) {
                const ghostElement = document.createElement('div');
                ghostElement.className = `pacman-ghost ghost-${ghost.color}`;
                if (ghost.scared) {
                    ghostElement.classList.add('ghost-scared');
                }
                cell.appendChild(ghostElement);
            }
        }

        function startPacmanGame() {
            gameRunning = true;
            startTimer();
            
            // Boucle de jeu
            gameLoop = setInterval(() => {
                if (!isPaused && gameRunning) {
                    updateGhosts();
                    checkCollisions();
                    checkWinCondition();
                }
            }, 200);
            
            // Gestion du clavier
            document.addEventListener('keydown', handleKeyPress);
        }

        function handleKeyPress(event) {
            if (!gameRunning || isPaused) return;
            
            switch(event.key.toLowerCase()) {
                case 'w':
                case 'arrowup':
                    movePacman('up');
                    break;
                case 's':
                case 'arrowdown':
                    movePacman('down');
                    break;
                case 'a':
                case 'arrowleft':
                    movePacman('left');
                    break;
                case 'd':
                case 'arrowright':
                    movePacman('right');
                    break;
                case ' ':
                    pauseGame();
                    break;
            }
            event.preventDefault();
        }

        function movePacman(direction) {
            if (!gameRunning || isPaused) return;
            
            let newX = pacmanPos.x;
            let newY = pacmanPos.y;
            
            switch(direction) {
                case 'up':
                    newY--;
                    break;
                case 'down':
                    newY++;
                    break;
                case 'left':
                    newX--;
                    break;
                case 'right':
                    newX++;
                    break;
            }
            
            // Vérifier les limites et les murs
            const targetCell = document.getElementById(`cell-${newX}-${newY}`);
            if (targetCell && !targetCell.classList.contains('pacman-wall')) {
                pacmanPos.x = newX;
                pacmanPos.y = newY;
                pacmanPos.direction = direction;
                updatePacmanPosition();
                
                // Collecter les points
                collectDot();
            }
        }

        function collectDot() {
            const cell = document.getElementById(`cell-${pacmanPos.x}-${pacmanPos.y}`);
            
            // Collecter point normal
            const dot = cell.querySelector('.pacman-dot');
            if (dot) {
                dot.remove();
                score += 10;
                document.getElementById('score').textContent = score;
                
                // Retirer de la liste
                dots = dots.filter(d => !(d.x === pacmanPos.x && d.y === pacmanPos.y));
            }
            
            // Collecter power pellet
            const power = cell.querySelector('.pacman-power');
            if (power) {
                power.remove();
                score += 50;
                document.getElementById('score').textContent = score;
                
                // Effrayer les fantômes
                ghosts.forEach(ghost => {
                    ghost.scared = true;
                    updateGhostPosition(ghost);
                });
                
                ghostScaredTime = 100; // 20 secondes à 200ms par tick
                
                // Retirer de la liste
                powerPellets = powerPellets.filter(p => !(p.x === pacmanPos.x && p.y === pacmanPos.y));
            }
        }

        function updateGhosts() {
            // Réduire le temps de peur
            if (ghostScaredTime > 0) {
                ghostScaredTime--;
                if (ghostScaredTime === 0) {
                    ghosts.forEach(ghost => {
                        ghost.scared = false;
                        updateGhostPosition(ghost);
                    });
                }
            }
            
            ghosts.forEach(ghost => {
                moveGhost(ghost);
            });
        }

        function moveGhost(ghost) {
            // IA simple pour les fantômes
            let possibleMoves = [];
            
            // Vérifier toutes les directions possibles
            const directions = [
                { x: 0, y: -1 }, // up
                { x: 0, y: 1 },  // down
                { x: -1, y: 0 }, // left
                { x: 1, y: 0 }   // right
            ];
            
            directions.forEach(dir => {
                const newX = ghost.x + dir.x;
                const newY = ghost.y + dir.y;
                const cell = document.getElementById(`cell-${newX}-${newY}`);
                
                if (cell && !cell.classList.contains('pacman-wall')) {
                    possibleMoves.push({ x: newX, y: newY, dir });
                }
            });
            
            if (possibleMoves.length > 0) {
                let targetMove;
                
                if (ghost.scared) {
                    // Fuir Pac-Man
                    targetMove = possibleMoves.reduce((farthest, move) => {
                        const distCurrent = Math.abs(move.x - pacmanPos.x) + Math.abs(move.y - pacmanPos.y);
                        const distFarthest = Math.abs(farthest.x - pacmanPos.x) + Math.abs(farthest.y - pacmanPos.y);
                        return distCurrent > distFarthest ? move : farthest;
                    });
                } else {
                    // Poursuivre Pac-Man (niveau élevé) ou mouvement aléatoire
                    if (level > 3) {
                        targetMove = possibleMoves.reduce((closest, move) => {
                            const distCurrent = Math.abs(move.x - pacmanPos.x) + Math.abs(move.y - pacmanPos.y);
                            const distClosest = Math.abs(closest.x - pacmanPos.x) + Math.abs(closest.y - pacmanPos.y);
                            return distCurrent < distClosest ? move : closest;
                        });
                    } else {
                        targetMove = possibleMoves[Math.floor(Math.random() * possibleMoves.length)];
                    }
                }
                
                ghost.x = targetMove.x;
                ghost.y = targetMove.y;
                ghost.direction = targetMove.dir;
                updateGhostPosition(ghost);
            }
        }

        function checkCollisions() {
            ghosts.forEach((ghost, index) => {
                if (ghost.x === pacmanPos.x && ghost.y === pacmanPos.y) {
                    if (ghost.scared) {
                        // Manger le fantôme
                        score += 200;
                        document.getElementById('score').textContent = score;
                        
                        // Respawn du fantôme
                        ghost.x = 10 - index;
                        ghost.y = 1;
                        ghost.scared = false;
                        updateGhostPosition(ghost);
                    } else {
                        // Game Over
                        gameRunning = false;
                        clearInterval(gameLoop);
                        endGame(false);
                    }
                }
            });
        }

        function checkWinCondition() {
            if (dots.length === 0 && powerPellets.length === 0) {
                // Niveau terminé - arrêter le jeu temporairement
                gameRunning = false;
                clearInterval(gameLoop);
                clearInterval(timerInterval);
                
                // Augmenter le niveau et le score
                level++;
                document.getElementById('level').textContent = level;
                score += 1000;
                document.getElementById('score').textContent = score;
                
                // Sauvegarder le niveau atteint
                saveGameLevel(currentGame, level);
                
                // Mettre à jour l'affichage du niveau personnel
                document.getElementById('playerLevelNumber').textContent = level;
                
                if (level > 5) {
                    // Jeu complètement terminé - victoire finale
                    endGame(true);
                } else {
                    // Niveau terminé - montrer message de félicitations et continuer
                    setTimeout(() => {
                        if (confirm(`🎉 Niveau terminé! Niveau suivant: ${level}\n\nVoulez-vous continuer ?`)) {
                            // Nouveau niveau
                            const game = getRandomGameVariation('pacman');
                            games['pacman'] = game;
                            initializePacmanMaze(game.maze);
                            startPacmanGame();
                        } else {
                            // Retour au menu
                            backToMenu();
                        }
                    }, 500);
                }
            }
        }

        function pauseGame() {
            isPaused = !isPaused;
            if (isPaused) {
                clearInterval(timerInterval);
                alert('Jeu en pause. Appuyez sur Espace pour continuer.');
            } else {
                startTimer();
            }
        }

        // 1. JEU DE MÉMOIRE CLASSIQUE
        function createMemoryGame(game) {
            gameData = [...game.items, ...game.items];
            shuffleArray(gameData);
            
            const board = document.getElementById('gameBoard');
            board.innerHTML = '';
            board.className = `grid gap-4 justify-center grid-cols-${game.gridSize}`;
            
            gameData.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'card-flip w-20 h-20 cursor-pointer relative';
                card.innerHTML = `
                    <div class="card-front bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center text-white font-bold border-2 border-white/20">
                        ?
                    </div>
                    <div class="card-back bg-white rounded-lg flex items-center justify-center text-4xl border-2 border-gray-200">
                        ${item}
                    </div>
                `;
                card.addEventListener('click', () => flipCard(index, card));
                board.appendChild(card);
            });
        }

        // 2. JEU SIMON SAYS
        function createSimonGame(game) {
            const board = document.getElementById('gameBoard');
            board.innerHTML = `
                <div class="text-center mb-6">
                    <h4 class="text-xl text-white mb-4">Niveau: <span id="simonLevel">1</span></h4>
                    <p class="text-gray-300">Mémorisez et répétez la séquence</p>
                </div>
                <div class="grid grid-cols-2 gap-4 max-w-md mx-auto">
                    ${game.colors.map((color, index) => `
                        <button class="simon-btn w-24 h-24 text-6xl rounded-lg border-4 border-white/20 hover:scale-105 transition-transform" 
                                data-color="${index}" onclick="simonClick(${index})">
                            ${color}
                        </button>
                    `).join('')}
                </div>
                <div class="text-center mt-6">
                    <button id="simonStart" onclick="startSimon()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-bold">
                        Commencer
                    </button>
                </div>
            `;
            
            games[currentGame].sequence = [];
            games[currentGame].playerSequence = [];
            games[currentGame].level = 1;
        }

        // 3. JEU DE RAPIDITÉ
        function createSpeedGame(game) {
            const board = document.getElementById('gameBoard');
            board.innerHTML = `
                <div class="text-center mb-6">
                    <h4 class="text-xl text-white mb-2">Trouvez tous les: ${game.target}</h4>
                    <p class="text-gray-300">Temps restant: <span id="speedTimer">${game.timeLimit}</span>s</p>
                    <p class="text-yellow-400">Trouvés: <span id="speedFound">0</span></p>
                </div>
                <div id="speedGrid" class="grid grid-cols-6 gap-2 max-w-lg mx-auto">
                </div>
            `;
            
            generateSpeedItems(game);
            startSpeedTimer(game.timeLimit);
        }

        // 4. JEU DE SÉQUENCE
        function createSequenceGame(game) {
            const board = document.getElementById('gameBoard');
            board.innerHTML = `
                <div class="text-center mb-6">
                    <h4 class="text-xl text-white mb-4">Mémorisez la séquence</h4>
                    <p class="text-gray-300">Observez puis répétez dans l'ordre</p>
                </div>
                <div id="sequenceDisplay" class="grid grid-cols-3 gap-4 max-w-md mx-auto mb-6">
                    ${game.items.map((item, index) => `
                        <div class="sequence-item w-20 h-20 bg-white/10 rounded-lg flex items-center justify-center text-4xl border-2 border-white/20" 
                             data-index="${index}" onclick="sequenceClick(${index})">
                            ${item}
                        </div>
                    `).join('')}
                </div>
                <div class="text-center">
                    <button id="sequenceStart" onclick="startSequence()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-bold">
                        Montrer la séquence
                    </button>
                </div>
            `;
        }

        // 5. JEU DE RECHERCHE
        function createFindGame(game) {
            const board = document.getElementById('gameBoard');
            board.innerHTML = `
                <div class="text-center mb-6">
                    <h4 class="text-xl text-white mb-4">Trouvez: ${game.target}</h4>
                    <p class="text-gray-300">Cliquez sur ${game.target} le plus rapidement possible</p>
                </div>
                <div id="findGrid" class="grid grid-cols-5 gap-3 max-w-lg mx-auto">
                </div>
            `;
            
            generateFindItems(game);
        }

        // 6. JEU DE CHEMIN
        function createPathGame(game) {
            const board = document.getElementById('gameBoard');
            board.innerHTML = `
                <div class="text-center mb-6">
                    <h4 class="text-xl text-white mb-4">Suivez le chemin</h4>
                    <p class="text-gray-300">Mémorisez le chemin puis répétez-le</p>
                </div>
                <div id="pathGrid" class="grid grid-cols-4 gap-2 max-w-md mx-auto mb-6">
                    ${Array(16).fill(0).map((_, index) => `
                        <div class="path-cell w-16 h-16 bg-white/10 rounded-lg border-2 border-white/20 flex items-center justify-center cursor-pointer hover:bg-white/20 transition-colors" 
                             data-index="${index}" onclick="pathClick(${index})">
                        </div>
                    `).join('')}
                </div>
                <div class="text-center">
                    <button id="pathStart" onclick="startPath()" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg font-bold">
                        Montrer le chemin
                    </button>
                </div>
            `;
        }

        function flipCard(index, cardElement) {
            if (isPaused || flippedCards.length >= 2 || flippedCards.includes(index) || cardElement.classList.contains('flipped')) {
                return;
            }
            
            cardElement.classList.add('flipped');
            flippedCards.push(index);
            
            if (flippedCards.length === 2) {
                setTimeout(checkMatch, 1000);
            }
        }

        function checkMatch() {
            const [first, second] = flippedCards;
            const cards = document.querySelectorAll('.card-flip');
            
            if (gameData[first] === gameData[second]) {
                // Match trouvé
                matchedPairs++;
                score += 10;
                document.getElementById('score').textContent = score;
                
                if (matchedPairs === gameData.length / 2) {
                    endGame(true);
                }
            } else {
                // Pas de match
                cards[first].classList.remove('flipped');
                cards[second].classList.remove('flipped');
            }
            
            flippedCards = [];
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                document.getElementById('timer').textContent = elapsed + 's';
            }, 1000);
        }

        function endGame(success = true) {
            clearInterval(timerInterval);
            clearInterval(gameLoop);
            gameRunning = false;
            
            const finalTime = Math.floor((Date.now() - startTime) / 1000);
            
            if (success) {
                // Sauvegarder le niveau suivant
                saveGameLevel(currentGame, level + 1);
                
                // Mettre à jour l'affichage du niveau personnel
                document.getElementById('playerLevelNumber').textContent = level + 1;
                
                // Message de succès personnalisé avec traductions
                const winMsg = translations[currentLanguage]['winMessage'] || translations['fr']['winMessage'];
                const completedIn = translations[currentLanguage]['completed-in'] || translations['fr']['completed-in'];
                const withScore = translations[currentLanguage]['with-score'] || translations['fr']['with-score'];
                const playAgain = translations[currentLanguage]['play-again'] || translations['fr']['play-again'];
                const menu = translations[currentLanguage]['menu'] || translations['fr']['menu'];
                
                document.getElementById('gameComplete').innerHTML = `
                    <h3 class="text-3xl font-bold text-green-400 mb-4"><p id="winMessage">${winMsg}</p></h3>
                    <p class="text-xl text-white mb-4">${completedIn} ${finalTime}s ${withScore} ${score} !</p>
                    <div class="bg-gradient-to-r from-yellow-400 to-orange-500 text-black px-6 py-3 rounded-lg font-bold mb-4 inline-block">
                        🏆 ${translations[currentLanguage]['level'] || 'Niveau'}: ${level + 1}
                    </div>
                    <p id="encouragement" class="text-gray-300 mb-6">${translations[currentLanguage]['encouragement'] || 'Excellent travail ! Votre mémoire s\'améliore à chaque partie.'}</p>
                    <button id="retryBtn" onclick="selectGame(currentGame)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-bold transition-colors mr-4">${playAgain}</button>
                    <button id="menuBtn" onclick="backToMenu()" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg font-bold transition-colors">${menu}</button>
                `;
            } else {
                // Message d'échec personnalisé avec traductions
                const loseMsg = translations[currentLanguage]['loseMessage'] || translations['fr']['loseMessage'];
                const encouragement = translations[currentLanguage]['encouragement'] || translations['fr']['encouragement'];
                const retry = translations[currentLanguage]['retry'] || translations['fr']['retry'];
                const menu = translations[currentLanguage]['menu'] || translations['fr']['menu'];
                const timeLabel = translations[currentLanguage]['time'] || translations['fr']['time'];
                const scoreLabel = translations[currentLanguage]['score'] || translations['fr']['score'];
                
                document.getElementById('gameComplete').innerHTML = `
                    <h3 class="text-3xl font-bold text-red-400 mb-4"><p id="loseMessage">${loseMsg}</p></h3>
                    <p class="text-xl text-white mb-4"><span id="timeLabel">${timeLabel}</span>: ${finalTime}s - <span id="scoreLabel">${scoreLabel}</span>: ${score}</p>
                    <p id="encouragement" class="text-gray-300 mb-6">${encouragement}</p>
                    <button id="retryBtn" onclick="selectGame(currentGame)" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-bold transition-colors mr-4">${retry}</button>
                    <button id="menuBtn" onclick="backToMenu()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-bold transition-colors">${menu}</button>
                `;
            }
            
            document.getElementById('gameComplete').classList.remove('hidden');
            
            // Scroll vers le message de fin
            document.getElementById('gameComplete').scrollIntoView({ behavior: 'smooth' });
        }

        function resetGame() {
            clearInterval(timerInterval);
            clearInterval(gameLoop);
            gameRunning = false;
            isPaused = false;
            pausedTime = 0;
            document.getElementById('gameComplete').classList.add('hidden');
            document.getElementById('pacmanControls').classList.add('hidden');
            document.getElementById('pauseOverlay').classList.add('hidden');
            // Sélectionner une nouvelle variation aléatoire pour le restart
            selectGame(currentGame);
        }

        // FONCTIONS SIMON SAYS
        function startSimon() {
            const game = games[currentGame];
            game.sequence = [];
            game.playerSequence = [];
            game.level = 1;
            addSimonStep();
        }

        function addSimonStep() {
            const game = games[currentGame];
            game.sequence.push(Math.floor(Math.random() * 4));
            document.getElementById('simonLevel').textContent = game.level;
            playSimonSequence();
        }

        function playSimonSequence() {
            const game = games[currentGame];
            let index = 0;
            
            const interval = setInterval(() => {
                if (index < game.sequence.length) {
                    highlightSimonButton(game.sequence[index]);
                    index++;
                } else {
                    clearInterval(interval);
                    game.playerSequence = [];
                }
            }, 800);
        }

        function highlightSimonButton(colorIndex) {
            const btn = document.querySelector(`[data-color="${colorIndex}"]`);
            btn.style.transform = 'scale(1.2)';
            btn.style.boxShadow = '0 0 20px rgba(255,255,255,0.8)';
            
            setTimeout(() => {
                btn.style.transform = 'scale(1)';
                btn.style.boxShadow = 'none';
            }, 400);
        }

        function simonClick(colorIndex) {
            if (isPaused) return;
            
            const game = games[currentGame];
            game.playerSequence.push(colorIndex);
            highlightSimonButton(colorIndex);
            
            // Vérifier si correct
            const currentIndex = game.playerSequence.length - 1;
            if (game.playerSequence[currentIndex] !== game.sequence[currentIndex]) {
                alert('Erreur! Recommencez.');
                startSimon();
                return;
            }
            
            // Si séquence complète
            if (game.playerSequence.length === game.sequence.length) {
                score += game.level * 10;
                document.getElementById('score').textContent = score;
                game.level++;
                
                if (game.level > 10) {
                    endGame(true);
                } else {
                    setTimeout(() => addSimonStep(), 1000);
                }
            }
        }

        // FONCTIONS SPEED GAME
        function generateSpeedItems(game) {
            const grid = document.getElementById('speedGrid');
            const items = [];
            
            // Ajouter des cibles
            for (let i = 0; i < 8; i++) {
                items.push(game.target);
            }
            
            // Ajouter des distracteurs
            for (let i = 0; i < 28; i++) {
                items.push(game.items[Math.floor(Math.random() * game.items.length)]);
            }
            
            shuffleArray(items);
            
            grid.innerHTML = items.map((item, index) => `
                <div class="speed-item w-12 h-12 bg-white/10 rounded-lg flex items-center justify-center text-2xl cursor-pointer hover:bg-white/20 transition-colors border border-white/20" 
                     onclick="speedClick('${item}', this)">
                    ${item}
                </div>
            `).join('');
        }

        function speedClick(item, element) {
            if (isPaused) return;
            
            const game = games[currentGame];
            if (item === game.target) {
                element.style.background = 'rgba(34, 197, 94, 0.8)';
                element.style.pointerEvents = 'none';
                score += 5;
                document.getElementById('score').textContent = score;
                
                const found = parseInt(document.getElementById('speedFound').textContent) + 1;
                document.getElementById('speedFound').textContent = found;
                
                if (found >= 8) {
                    endGame(true);
                }
            } else {
                element.style.background = 'rgba(239, 68, 68, 0.8)';
                score = Math.max(0, score - 2);
                document.getElementById('score').textContent = score;
            }
        }

        function startSpeedTimer(timeLimit) {
            let timeLeft = timeLimit;
            const timerElement = document.getElementById('speedTimer');
            
            const countdown = setInterval(() => {
                timeLeft--;
                timerElement.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    clearInterval(countdown);
                    // Vérifier si assez de cibles trouvées
                    const found = parseInt(document.getElementById('speedFound').textContent);
                    endGame(found >= 6); // Succès si au moins 6 cibles trouvées
                }
            }, 1000);
        }

        // FONCTIONS SEQUENCE GAME
        function startSequence() {
            const game = games[currentGame];
            game.sequence = [];
            
            // Générer une séquence aléatoire
            for (let i = 0; i < 5; i++) {
                game.sequence.push(Math.floor(Math.random() * game.items.length));
            }
            
            // Afficher la séquence
            showSequence();
        }

        function showSequence() {
            const game = games[currentGame];
            let index = 0;
            
            const interval = setInterval(() => {
                if (index < game.sequence.length) {
                    highlightSequenceItem(game.sequence[index]);
                    index++;
                } else {
                    clearInterval(interval);
                    game.playerSequence = [];
                    document.getElementById('sequenceStart').textContent = 'Répétez la séquence!';
                }
            }, 1000);
        }

        function highlightSequenceItem(itemIndex) {
            const item = document.querySelector(`[data-index="${itemIndex}"]`);
            item.style.background = 'rgba(59, 130, 246, 0.8)';
            item.style.transform = 'scale(1.1)';
            
            setTimeout(() => {
                item.style.background = 'rgba(255, 255, 255, 0.1)';
                item.style.transform = 'scale(1)';
            }, 500);
        }

        function sequenceClick(itemIndex) {
            if (isPaused) return;
            
            const game = games[currentGame];
            if (!game.playerSequence) return;
            
            game.playerSequence.push(itemIndex);
            highlightSequenceItem(itemIndex);
            
            // Vérifier si correct
            const currentIndex = game.playerSequence.length - 1;
            if (game.playerSequence[currentIndex] !== game.sequence[currentIndex]) {
                alert('Erreur! Recommencez.');
                startSequence();
                return;
            }
            
            // Si séquence complète
            if (game.playerSequence.length === game.sequence.length) {
                score += 50;
                document.getElementById('score').textContent = score;
                endGame(true);
            }
        }

        // FONCTIONS FIND GAME
        function generateFindItems(game) {
            const grid = document.getElementById('findGrid');
            const items = [];
            
            // Ajouter la cible
            items.push(game.target);
            
            // Ajouter des distracteurs
            for (let i = 0; i < 24; i++) {
                items.push(game.distractors[Math.floor(Math.random() * game.distractors.length)]);
            }
            
            shuffleArray(items);
            
            grid.innerHTML = items.map((item, index) => `
                <div class="find-item w-16 h-16 bg-white/10 rounded-lg flex items-center justify-center text-3xl cursor-pointer hover:bg-white/20 transition-colors border border-white/20" 
                     onclick="findClick('${item}', this)">
                    ${item}
                </div>
            `).join('');
        }

        function findClick(item, element) {
            if (isPaused) return;
            
            const game = games[currentGame];
            if (item === game.target) {
                element.style.background = 'rgba(34, 197, 94, 0.8)';
                score += 20;
                document.getElementById('score').textContent = score;
                endGame(true);
            } else {
                element.style.background = 'rgba(239, 68, 68, 0.8)';
                element.style.pointerEvents = 'none';
                score = Math.max(0, score - 5);
                document.getElementById('score').textContent = score;
            }
        }

        // FONCTIONS PATH GAME
        function startPath() {
            const game = games[currentGame];
            game.path = [];
            game.playerPath = [];
            
            // Générer un chemin aléatoire
            for (let i = 0; i < 6; i++) {
                let nextCell;
                do {
                    nextCell = Math.floor(Math.random() * 16);
                } while (game.path.includes(nextCell));
                game.path.push(nextCell);
            }
            
            // Afficher le chemin
            showPath();
        }

        function showPath() {
            const game = games[currentGame];
            let index = 0;
            
            const interval = setInterval(() => {
                if (index < game.path.length) {
                    const cell = document.querySelector(`[data-index="${game.path[index]}"]`);
                    cell.textContent = game.items[index % game.items.length];
                    cell.style.background = 'rgba(59, 130, 246, 0.8)';
                    
                    setTimeout(() => {
                        cell.style.background = 'rgba(255, 255, 255, 0.1)';
                    }, 800);
                    
                    index++;
                } else {
                    clearInterval(interval);
                    // Effacer les symboles après affichage
                    setTimeout(() => {
                        document.querySelectorAll('.path-cell').forEach(cell => {
                            cell.textContent = '';
                        });
                        document.getElementById('pathStart').textContent = 'Répétez le chemin!';
                    }, 1000);
                }
            }, 1000);
        }

        function pathClick(cellIndex) {
            if (isPaused) return;
            
            const game = games[currentGame];
            if (!game.playerPath) return;
            
            game.playerPath.push(cellIndex);
            const cell = document.querySelector(`[data-index="${cellIndex}"]`);
            cell.style.background = 'rgba(34, 197, 94, 0.8)';
            
            // Vérifier si correct
            const currentIndex = game.playerPath.length - 1;
            if (game.playerPath[currentIndex] !== game.path[currentIndex]) {
                alert('Erreur! Recommencez.');
                startPath();
                return;
            }
            
            // Si chemin complet
            if (game.playerPath.length === game.path.length) {
                score += 30;
                document.getElementById('score').textContent = score;
                endGame(true);
            }
        }

        // FONCTIONS UTILITAIRES
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function arraysEqual(a, b) {
            return a.length === b.length && a.every((val, i) => val === b[i]);
        }

        // FONCTIONS DE LANGUE
        function applyGameTexts(lang) {
            const t = translations[lang];
            const winMessageEl = document.getElementById("winMessage");
            const loseMessageEl = document.getElementById("loseMessage");
            const encouragementEl = document.getElementById("encouragement");
            const retryBtnEl = document.getElementById("retryBtn");
            const menuBtnEl = document.getElementById("menuBtn");
            const scoreLabelEl = document.getElementById("scoreLabel");
            const levelLabelEl = document.getElementById("levelLabel");
            const timeLabelEl = document.getElementById("timeLabel");
            
            if (winMessageEl) winMessageEl.textContent = t.winMessage;
            if (loseMessageEl) loseMessageEl.textContent = t.loseMessage;
            if (encouragementEl) encouragementEl.textContent = t.encouragement;
            if (retryBtnEl) retryBtnEl.textContent = t.retry;
            if (menuBtnEl) menuBtnEl.textContent = t.menu;
            if (scoreLabelEl) scoreLabelEl.textContent = t.score;
            if (levelLabelEl) levelLabelEl.textContent = t.level;
            if (timeLabelEl) timeLabelEl.textContent = t.time;
        }

        function toggleLanguageMenu() {
            const menu = document.getElementById('languageMenu');
            const arrow = document.getElementById('languageArrow');
            
            if (menu.classList.contains('hidden')) {
                menu.classList.remove('hidden');
                arrow.style.transform = 'rotate(180deg)';
            } else {
                menu.classList.add('hidden');
                arrow.style.transform = 'rotate(0deg)';
            }
        }

        function selectLanguage(lang, flag, name) {
            currentLanguage = lang;
            document.getElementById('currentFlag').textContent = flag;
            document.getElementById('currentLang').textContent = name;
            document.getElementById('languageMenu').classList.add('hidden');
            document.getElementById('languageArrow').style.transform = 'rotate(0deg)';
            
            // Appliquer les traductions
            translatePage();
            applyGameTexts(lang);
            
            // Mettre à jour le texte de l'objectif Pac-Man s'il existe
            const objectiveText = document.getElementById("objectiveText");
            if (objectiveText) {
                objectiveText.textContent = translations[lang].objective;
            }
        }

        function translatePage() {
            const elements = document.querySelectorAll('[data-translate]');
            elements.forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    element.textContent = translations[currentLanguage][key];
                }
            });
            
            // Appliquer les traductions spécifiques aux jeux
            applyGameTexts(currentLanguage);
        }

        // Fermer le menu si on clique ailleurs
        document.addEventListener('click', function(event) {
            const languageToggle = document.getElementById('languageToggle');
            const languageMenu = document.getElementById('languageMenu');
            
            if (!languageToggle.contains(event.target) && !languageMenu.contains(event.target)) {
                languageMenu.classList.add('hidden');
                document.getElementById('languageArrow').style.transform = 'rotate(0deg)';
            }
        });

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            translatePage();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98106d52d43fe167',t:'MTc1ODE5NDE0My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
Remplacement du code par la version améliorée
  

       

          
       
    
      
    

        
        
              
              
                 
                  
              
               
            
              
              
    
              
              
            
             
         
      
        

      

        

